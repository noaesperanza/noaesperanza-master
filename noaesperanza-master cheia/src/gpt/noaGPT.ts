// noaGPT.ts
import { promptInstitucional } from '@/noa-repo/config/promptInstitucional'
import { codeEditorAgent } from './codeEditorAgent'
import { courseAdminAgent } from './courseAdminAgent'
import { knowledgeBaseAgent } from './knowledgeBaseAgent'
import { supabaseService } from '../services/supabaseService'
import { clinicalAgent } from './clinicalAgent'
// import { symbolicAgent } from './symbolicAgent'
// import { voiceControlAgent } from './voiceControlAgent'

export class NoaGPT {
  async processCommand(message: string): Promise<string> {
    const lower = message.toLowerCase().trim()

    // üîë ATIVA√á√ÉO DE VOZ (em desenvolvimento)
    if (
      lower.includes('ativar controle por voz') ||
      lower.includes('modo voz noa')
    ) {
      return `üé§ Controle por voz: Funcionalidade em desenvolvimento.`
    }

    // üìé ADICIONAR DOCUMENTO
    if (
      lower.includes('adicionar documento') ||
      lower.includes('enviar documento') ||
      lower.includes('inserir pdf') ||
      lower.includes('subir arquivo')
    ) {
      return 'üìÇ Por favor, envie o documento agora para que eu possa processar.'
    }

    // üíª COMANDOS DE C√ìDIGO
    if (
      lower.includes('editar c√≥digo') ||
      lower.includes('alterar c√≥digo') ||
      lower.includes('editar o arquivo') ||
      lower.includes('modificar componente')
    ) {
      return await codeEditorAgent.editarArquivo(message)
    }

    // üìö ADMINISTRA√á√ÉO DE CURSOS
    if (
      lower.includes('criar aula') ||
      lower.includes('editar aula') ||
      lower.includes('organizar curso') ||
      lower.includes('listar aulas') ||
      lower.includes('atualizar trilha') ||
      lower.includes('cursos dispon√≠veis') ||
      lower.includes('cursos disponiveis') ||
      lower.includes('aulas') ||
      lower.includes('educa√ß√£o') ||
      lower.includes('educacao') ||
      lower.includes('cursos')
    ) {
      return await courseAdminAgent.executarTarefa(message)
    }

    // üìñ BASE DE CONHECIMENTO
    if (
      lower.includes('criar conhecimento') ||
      lower.includes('editar conhecimento') ||
      lower.includes('listar conhecimentos') ||
      lower.includes('base de dados') ||
      lower.includes('adicionar √† base') ||
      lower.includes('conhecimentos') ||
      lower.includes('conhecimento') ||
      lower.includes('base de conhecimento')
    ) {
      return await knowledgeBaseAgent.executarAcao(message)
    }

    // ü©∫ AVALIA√á√ÉO CL√çNICA (DRC, AEC, Risco)
    if (
      lower.includes('avalia√ß√£o cl√≠nica') ||
      lower.includes('avaliacao clinica') ||
      lower.includes('aplicar arte da entrevista cl√≠nica') ||
      lower.includes('an√°lise de risco') ||
      lower.includes('simula√ß√£o cl√≠nica') ||
      lower.includes('aplicar avaliacao clinica inicial') ||
      lower.includes('iniciar avalia√ß√£o cl√≠nica') ||
      lower.includes('iniciar avaliacao clinica') ||
      lower.includes('avalia√ß√£o inicial') ||
      lower.includes('avaliacao inicial') ||
      lower.includes('come√ßar avalia√ß√£o') ||
      lower.includes('comecar avaliacao')
    ) {
      return await clinicalAgent.executarFluxo(message)
    }

    // üåÄ EIXO SIMB√ìLICO (em desenvolvimento)
    if (
      lower.includes('curadoria simb√≥lica') ||
      lower.includes('ancestralidade') ||
      lower.includes('projeto cultural') ||
      lower.includes('tradi√ß√£o') ||
      lower.includes('diagn√≥stico simb√≥lico')
    ) {
      return `üåÄ Eixo Simb√≥lico: Funcionalidade em desenvolvimento.`
    }

    // üíæ SUPABASE: A√á√ïES EM ARQUIVOS
    if (
      lower.includes('salvar arquivo') ||
      lower.includes('modificar arquivo') ||
      lower.includes('atualizar base') ||
      lower.includes('escrever no banco')
    ) {
      return await supabaseService.salvarArquivoViaTexto(message)
    }

    // üí¨ SAUDA√á√ïES E CONVERSAS GERAIS
    if (
      lower.includes('ola') ||
      lower.includes('ol√°') ||
      lower.includes('oi') ||
      lower.includes('bom dia') ||
      lower.includes('boa tarde') ||
      lower.includes('boa noite') ||
      lower.includes('como voc√™ est√°') ||
      lower.includes('tudo bem') ||
      lower.includes('como vai') ||
      lower.includes('e a√≠') ||
      lower.includes('hey') ||
      lower.includes('hi')
    ) {
      return `Ol√°! Sou a NOA Esperanza, assistente m√©dica do Dr. Ricardo Valen√ßa. Estou aqui para ajudar com avalia√ß√µes cl√≠nicas nas especialidades de neurologia, cannabis medicinal e nefrologia. Como posso ajud√°-lo hoje?`
    }

    // üè• PERGUNTAS M√âDICAS GERAIS
    if (
      lower.includes('dor') ||
      lower.includes('sintoma') ||
      lower.includes('medicamento') ||
      lower.includes('tratamento') ||
      lower.includes('consulta') ||
      lower.includes('m√©dico') ||
      lower.includes('sa√∫de') ||
      lower.includes('doen√ßa') ||
      lower.includes('cannabis') ||
      lower.includes('neurologia') ||
      lower.includes('nefrologia')
    ) {
      return `Entendo sua quest√£o m√©dica. Como assistente especializada, posso orient√°-lo sobre avalia√ß√µes cl√≠nicas e informa√ß√µes gerais. Para uma consulta espec√≠fica, recomendo agendar com o Dr. Ricardo Valen√ßa. Como posso ajud√°-lo com informa√ß√µes ou avalia√ß√µes?`
    }

    // üí¨ RESPOSTA NATURAL PARA CONVERSAS GERAIS
    return `Entendo sua pergunta. Como assistente m√©dica especializada em neurologia, cannabis medicinal e nefrologia, posso ajud√°-lo com:

‚Ä¢ Avalia√ß√µes cl√≠nicas estruturadas
‚Ä¢ Orienta√ß√µes sobre tratamentos
‚Ä¢ Informa√ß√µes sobre especialidades m√©dicas
‚Ä¢ Cria√ß√£o de conte√∫do educativo

Como posso ajud√°-lo especificamente hoje?`
  }
}
